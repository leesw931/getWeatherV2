<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>우리가족 날씨앱</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <script>
    const password = '0831';
    if (password !== "0831") {
      document.body.innerHTML = "<h2 style='text-align:center; color:red;'>잘못된 접근입니다.</h2>";
      throw new Error("접근 차단");
    }
  </script>

  <div class="container">
    <header>
      <h1>🌤 우리가족 날씨</h1>
      <select id="regionSelect">
        <option value="34.4465,126.6706">만수리</option>
        <option value="37.3225,127.0947">수지</option>
        <option value="37.6408,126.6444">마산동</option>
      </select>
    </header>

    <div class="tab-buttons">
      <button id="nowTab" class="active">Now</button>
      <button id="days10Tab">10 Days</button>
    </div>

    <section id="nowSection">
      <div id="backgroundScroller">
        <div id="backgroundImages"></div>
      </div>
      <div id="fixedWeatherInfo">
        <p id="weatherTime"></p>
        <img id="weatherIcon" class="weather-icon" />
        <p id="weatherTemp"></p>
      </div>
    </section>

    <section id="days10Section" style="display: none;">
      <div id="days10Container">
        <!-- 중기예보 카드 형식 들어갈 자리 -->
      </div>
    </section>
  </div>

  <script>
    const regionSelect = document.getElementById("regionSelect");
    const nowTab = document.getElementById("nowTab");
    const days10Tab = document.getElementById("days10Tab");
    const nowSection = document.getElementById("nowSection");
    const days10Section = document.getElementById("days10Section");

    const backgroundImages = document.getElementById("backgroundImages");
    const weatherTime = document.getElementById("weatherTime");
    const weatherIcon = document.getElementById("weatherIcon");
    const weatherTemp = document.getElementById("weatherTemp");

    let currentIndex = 0;
    let forecastData = [];

    nowTab.addEventListener("click", () => {
      nowTab.classList.add("active");
      days10Tab.classList.remove("active");
      nowSection.style.display = "block";
      days10Section.style.display = "none";
    });

    days10Tab.addEventListener("click", () => {
      days10Tab.classList.add("active");
      nowTab.classList.remove("active");
      days10Section.style.display = "block";
      nowSection.style.display = "none";
    });

    regionSelect.addEventListener("change", fetchForecast);

    async function fetchForecast() {
      const [lat, lon] = regionSelect.value.split(",");
      const url = `https://api.met.no/weatherapi/locationforecast/2.0/compact?lat=${lat}&lon=${lon}`;

      try {
        const res = await fetch(url);
        const data = await res.json();
        forecastData = data.properties.timeseries.slice(0, 6);
        renderBackgrounds(forecastData);
        updateWeatherDisplay(0);
      } catch (err) {
        alert("날씨 정보를 불러오지 못했습니다: " + err.message);
        console.error(err);
      }
    }

    function renderBackgrounds(timeseries) {
      backgroundImages.innerHTML = "";
      timeseries.forEach(entry => {
        const symbol = entry.data.next_1_hours?.summary?.symbol_code || "clearsky_day";
        const bg = document.createElement("div");
        bg.className = "bg-slide";
        bg.style.backgroundImage = `url('./assets/backgrounds/${symbol}.jpg')`;
        backgroundImages.appendChild(bg);
      });
    }

    function updateWeatherDisplay(index) {
      if (!forecastData[index]) return;
      const entry = forecastData[index];
      const time = new Date(entry.time).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      const temp = entry.data.instant.details.air_temperature;
      const symbol = entry.data.next_1_hours?.summary?.symbol_code || "clearsky_day";

      weatherTime.textContent = time;
      weatherTemp.textContent = `${temp}℃`;
      weatherIcon.src = `./assets/icons/${symbol}.svg`;
      weatherIcon.alt = symbol;
    }

    // 스크롤 이벤트 감지해서 index 변경
    document.getElementById("backgroundScroller").addEventListener("scroll", (e) => {
      const scrollX = e.target.scrollLeft;
      const width = e.target.clientWidth;
      const newIndex = Math.round(scrollX / width);
      if (newIndex !== currentIndex) {
        currentIndex = newIndex;
        updateWeatherDisplay(currentIndex);
      }
    });

    // 초기 호출
    fetchForecast();
  </script>
</body>
</html>
